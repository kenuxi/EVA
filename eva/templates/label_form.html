<table id="table_id" class="table table-striped table-bordered" style="width:100%">
  <thead>
      <tr>
        <th>ID</th>
        {% for column in df.columns %}
          <th>{{ column }}</th>
        {% endfor %}
      </tr>
  </thead>
  <tbody>
    {% for row in df.head(5).itertuples() %}
      <tr>
        {% for column in row %}
          <td>{{ column }}</td>
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

<div class="content-section">
  <div class="row">
    <div class="col-12 mt-3 mb-3">
      <form method="POST" action="">
        {{ label_form.hidden_tag() }}

        <fieldset class="form-group">
          <legend class="border-bottom mb-4">Labels and Outliers</legend>
          <div class="row">

            <div class="form-group col-3">
              Rows: {{df.shape[0]}} <br/>
              Columns: {{df.shape[1]}} <br/>
              Inliers Selected: <p id="num_inliers">0</p>
              Outliers Selected: <p id="num_outliers">0</p>
            </div>

            <div class="form-group col-3">
              <p>{{ label_form.label_column.label }}
              {{ label_form.label_column }}</p>
              {% for error in label_form.label_column.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}

              <p>
                {{ label_form.ratio_bool }}
                {{ label_form.ratio.label }}
                {{ label_form.ratio }}
              </p>
              {% for error in label_form.ratio_bool.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}

              {% for error in label_form.ratio.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}

              <p>
                {{ label_form.normalize_bool }}
                Normalize data?
              </p>

              <p>
                {{ label_form.preprocess_bool }}
                PCA preprocessing?
                {{ label_form.preprocess }}
              </p>
              {% for error in label_form.preprocess_bool.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}

              {% for error in label_form.preprocess.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}

            </div>

            <div class="form-group col-3">
              <h5>{{ label_form.inliers.label(class="form-control-label") }}</h5>
              {{ label_form.inliers }}
              {% for error in label_form.inliers.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}
            </div>

            <div class="form-group col-3">
              <h5>{{ label_form.outliers.label(class="form-control-label") }}</h5>
              {{ label_form.outliers }}
              {% for error in label_form.outliers.errors %}
                <span style="color: red;">[{{ error }}]</span>
              {% endfor %}
            </div>

          </div>
        </fieldset>

        <div class="form-group">
         {{ label_form.label_submit(class="btn btn-outline-info") }}
        </div>

        <script>
          let column_select = document.getElementById('label_column')
          let inliers_select = document.getElementById('inliers')
          let outliers_select = document.getElementById('outliers')
          let num_inliers_select = document.getElementById('num_inliers')
          let num_outliers_select = document.getElementById('num_outliers')

          column_select.onchange = function () {
            column = column_select.value;

            fetch('/getlabels/' + column).then(function(response) {
              response.json().then(function(data) {
                let optionHtml = ''
                for (let label of data.labels) {
                  optionHtml += '<option value="' + label + '">' + label + '</option>';
                }

                inliers_select.innerHTML = optionHtml;
                outliers_select.innerHTML = optionHtml;
              });
            });
          }

          inliers_select.onchange = function () {
            let selectedInliers = Array.from(inliers_select.selectedOptions).map(option => option.value);

            fetch('/getnumrows/' + [selectedInliers]).then(function(response) {
              response.json().then(function(data) {
                num_inliers_select.innerHTML = data.num_rows;
              });
            });
          };

          outliers_select.onchange = function () {
            let selectedOutliers = Array.from(outliers_select.selectedOptions).map(option => option.value);

            fetch('/getnumrows/' + [selectedOutliers]).then(function(response) {
              response.json().then(function(data) {
                num_outliers_select.innerHTML = data.num_rows;
              });
            });
          };
        </script>
      </form>
    </div>
  </div>
</div>


